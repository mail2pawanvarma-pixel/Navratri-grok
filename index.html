<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Navratri Celebration</title>
<style>
  :root{
    --bg1:#fff0f5;
    --bg2:#fff4e6;
    --accent-maroon:#7a1226;
    --accent-gold:#d4a017;
    --accent-cyan:#00cfd8;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased;overflow:hidden;}
  .stage{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:18px;box-sizing:border-box;}

  /* --- Landing (first screen) --- */
  #landing{position:fixed;inset:0;z-index:90;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:20px;box-sizing:border-box;}
  .landing-card{width:100%;max-width:980px;padding:26px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.95),rgba(255,250,245,0.98));box-shadow:0 12px 40px rgba(122,18,38,0.08);text-align:center;}
  .landing-title{font-size:clamp(20px,4.8vw,44px);font-weight:800;color:var(--accent-maroon);background:linear-gradient(90deg,var(--accent-maroon),var(--accent-gold));-webkit-background-clip:text;color:transparent;}
  .landing-sub{font-size:14px;color:#6b1020;margin-top:8px;}
  .reveal-btn{margin-top:14px;padding:14px 28px;border-radius:999px;border:0;background:linear-gradient(90deg,var(--accent-maroon),var(--accent-gold));color:#fff;font-weight:800;cursor:pointer;box-shadow:0 10px 30px rgba(122,18,38,0.12);}

  /* --- Celebration (hidden until reveal) --- */
  #celebration{position:fixed;inset:0;z-index:10;opacity:0;pointer-events:none;display:flex;align-items:center;justify-content:center;padding:18px;transition:opacity .6s ease;}
  .card{width:100%;max-width:1100px;height:calc(100vh - 36px);border-radius:16px;padding:22px;box-sizing:border-box;display:flex;flex-direction:column;align-items:center;gap:12px;background:linear-gradient(180deg,rgba(255,250,250,0.92),rgba(255,249,242,0.98));box-shadow:0 14px 36px rgba(122,18,38,0.06);overflow:hidden;}

  .happy-text{font-weight:900;font-size:clamp(26px,5.5vw,64px);color:var(--accent-maroon);background:linear-gradient(90deg,var(--accent-maroon),var(--accent-gold));-webkit-background-clip:text;color:transparent;text-align:center;margin-top:6px;}
  .gif-wrap{width:100%;display:flex;align-items:center;justify-content:center;padding:6px;box-sizing:border-box;}
  img.navratri{width:clamp(300px,44vw,780px);max-height:60vh;object-fit:cover;border-radius:16px;border:3px solid rgba(212,160,23,0.08);box-shadow:0 24px 48px rgba(122,18,38,0.08);}

  /* Greeting with no gap */
  .greeting{margin-top:6px;padding:12px 18px;border-radius:12px;background:linear-gradient(90deg,rgba(255,240,244,0.85),rgba(255,250,236,0.95));display:inline-block;}
  .greeting .message{font-weight:800;font-size:clamp(16px,3vw,26px);color:var(--accent-maroon);white-space:normal;line-height:1.3;}
  .greeting .name{font-weight:900;background:linear-gradient(90deg,var(--accent-gold),var(--accent-maroon));-webkit-background-clip:text;color:transparent;padding:0;margin:0;}
  .greeting .sep{display:inline;margin:0 4px;color:var(--accent-maroon);}

  /* Controls */
  .controls{display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap;margin-top:8px;width:100%;}
  .input{min-width:200px;max-width:560px;width:calc(40vw);padding:12px 14px;border-radius:12px;border:1px solid rgba(122,18,38,0.06);background:#fff;color:var(--accent-maroon);font-size:1.05rem;outline:none;box-shadow:0 8px 20px rgba(0,0,0,0.04);text-align:center;}
  .input::placeholder{color:#a34e53;opacity:0.7;}
  .controls-row{display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap;margin-top:8px;}
  .gift-button{display:inline-flex;align-items:center;gap:10px;padding:12px 20px;border-radius:999px;background:linear-gradient(90deg,var(--accent-maroon),var(--accent-gold));color:#fff;font-weight:800;text-decoration:none;box-shadow:0 10px 30px rgba(122,18,38,0.12);font-size:1.05rem;}
  .gift-button.disabled{opacity:0.56;pointer-events:none;box-shadow:none;}
  .wa-button{display:inline-flex;align-items:center;gap:8px;padding:12px 18px;border-radius:999px;background:#075e54;color:#fff;font-weight:800;text-decoration:none;box-shadow:0 10px 28px rgba(7,94,84,0.18);font-size:1.05rem;}

  /* Mute button (top-right) */
  .mute-btn{position:fixed;top:12px;right:12px;z-index:100;border:0;background:#fff;border-radius:999px;padding:8px;box-shadow:0 6px 18px rgba(0,0,0,0.12);cursor:pointer;width:44px;height:44px;display:flex;align-items:center;justify-content:center;}

  /* Canvas & falling layers */
  canvas#fx{position:absolute;inset:0;width:100%;height:100%;z-index:5;pointer-events:none;}
  .falling-layer,.balloon-layer{position:absolute;inset:0;pointer-events:none;z-index:7;overflow:hidden;}

  /* Responsive tweaks */
  @media (max-width:640px){
    .input{width:88%;}
    .happy-text{font-size:28px;}
    img.navratri{width:86%;max-height:48vh;}
    .greeting .message{font-size:16px;}
  }
</style>
</head>
<body>
<div class="stage">

  <!-- Landing screen -->
  <div id="landing" role="dialog" aria-modal="true" aria-label="Landing">
    <div class="landing-card" role="group" aria-labelledby="landingTitle">
      <div id="landingTitle" class="landing-title">Special Navratri message waiting for you</div>
      <div class="landing-sub">Click below to reveal the Navratri celebration</div>
      <button id="revealBtn" class="reveal-btn" aria-label="Click to reveal">Click to Reveal</button>
      <div class="landing-sub" style="font-size:12px;margin-top:10px;color:#7a1226;">(Music & celebration start after you click)</div>
    </div>
  </div>

  <!-- Celebration screen -->
  <main id="celebration" aria-hidden="true">
    <div class="card" role="main">
      <button id="muteBtn" class="mute-btn" aria-label="Mute or unmute audio" title="Mute / Unmute">
        <!-- Speaker icon (SVG) -->
        <svg id="muteIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M5 9v6h4l5 4V5L9 9H5z" fill="#7a1226"></path>
        </svg>
      </button>

      <div class="happy-text">Happy Navratri</div>

      <div class="gif-wrap">
        <img id="navGif" class="navratri" src="Navratri.gif" alt="Navratri image (place Navratri.gif here)" onerror="this.style.display='none'">
      </div>

      <div class="greeting" role="status" aria-live="polite">
        <div class="message">
          <span id="nameEl" class="name">Someone</span><span class="sep"> ki taraf se </span><span id="msgEl">aapko Navratri ki bahut bahut badhai</span>
        </div>
      </div>

      <div class="controls" aria-label="Inputs">
        <input id="nameInput" class="input" placeholder="Enter your name" />
        <input id="msgInput" class="input" placeholder="Type your message" />
      </div>

      <div class="controls-row" aria-label="Actions">
        <!-- Put your affiliate link directly in href below.
             Example: href="https://www.amazon.in/your-product?tag=yourtag-21" -->
        <a id="giftBtn" class="gift-button" href="https://amzn.to/3KgAfuZ" target="_blank" rel="noopener">üéÅ Special Navratri Gifts üéÅ</a>

        <a id="waShare" class="wa-button" href="#" target="_blank" rel="noopener">Share</a>
      </div>

      <canvas id="fx"></canvas>
      <div id="flowers" class="falling-layer" aria-hidden="true"></div>
      <div id="balloons" class="balloon-layer" aria-hidden="true"></div>
    </div>
  </main>

</div>

<!-- Local audio file -->
<audio id="bgAudio" src="Navratri.mp3" preload="auto" loop crossorigin="anonymous"></audio>

<script>
/* Full functional Navratri page
   - Landing reveals celebration
   - Greeting shows URL ?name & ?msg automatically (if present) but inputs keep placeholders
   - Inputs update the greeting preview while typing
   - Share opens WhatsApp (or navigator.share if available) and then clears inputs (placeholders remain)
   - Gift button opens href (enable by replacing YOUR_AFFILIATE_LINK)
   - Mute/unmute button and audio pauses when tab hidden (minimized)
   - Confetti/flowers/balloons running (reduced density)
*/

const qs = s => document.querySelector(s);
const landing = qs('#landing');
const revealBtn = qs('#revealBtn');
const celebration = qs('#celebration');
const audioEl = qs('#bgAudio');
const muteBtn = qs('#muteBtn');
const muteIcon = qs('#muteIcon');

const nameEl = qs('#nameEl');
const msgEl = qs('#msgEl');

const nameInput = qs('#nameInput');
const msgInput = qs('#msgInput');
const giftBtn = qs('#giftBtn');
const waShare = qs('#waShare');

const canvas = qs('#fx');
const ctx = canvas.getContext('2d');
const flowersLayer = qs('#flowers');
const balloonsLayer = qs('#balloons');

let cw, ch; function resizeCanvas(){ cw = canvas.width = innerWidth; ch = canvas.height = innerHeight; }
resizeCanvas(); window.addEventListener('resize', resizeCanvas);

/* Defaults and current greeting */
const DEFAULT_NAME = 'Someone';
const DEFAULT_MSG = 'aapko Navratri ki bahut bahut badhai';
let current = { name: DEFAULT_NAME, msg: DEFAULT_MSG };

/* Init from URL (show greeting on page if params exist, but DO NOT replace placeholders) */
(function initFromURL(){
  const p = new URLSearchParams(window.location.search);
  const pName = (p.get('name') || '').trim();
  const pMsg = (p.get('msg') || '').trim();
  if(pName) current.name = decodeURIComponent(pName);
  if(pMsg) current.msg = decodeURIComponent(pMsg);
  nameEl.textContent = current.name;
  msgEl.textContent = current.msg;
  updateWaLink();
})();

/* Update greeting preview (live) but inputs always keep placeholders */
function updateGreeting(){
  const nTyped = (nameInput.value || '').trim();
  const mTyped = (msgInput.value || '').trim();
  // If user typed something, show that; otherwise fall back to current (from URL or default)
  const showName = nTyped || current.name || DEFAULT_NAME;
  const showMsg = mTyped || current.msg || DEFAULT_MSG;
  nameEl.textContent = showName;
  msgEl.textContent = showMsg;
  updateWaLinkWith(showName, showMsg);
}
nameInput.addEventListener('input', updateGreeting);
msgInput.addEventListener('input', updateGreeting);

/* Build WhatsApp share link or use Web Share API when available */
function updateWaLink(){
  updateWaLinkWith(current.name, current.msg);
}
function updateWaLinkWith(name, msg){
  const n = encodeURIComponent(name || DEFAULT_NAME);
  const m = encodeURIComponent(msg || DEFAULT_MSG);
  const pageUrl = `${location.origin}${location.pathname}?name=${n}&msg=${m}`;
  const text = `${name} ki taraf se: ${msg} - ${pageUrl}`;
  waShare.href = `https://wa.me/?text=${encodeURIComponent(text)}`;
}

/* Enable gift button only if a real link is present in href */
(function initGift(){
  const href = (giftBtn.getAttribute('href')||'').trim();
  const enabled = href && !href.includes('YOUR_AFFILIATE_LINK') && (href.startsWith('http://') || href.startsWith('https://'));
  if(!enabled){
    giftBtn.classList.add('disabled');
    giftBtn.addEventListener('click', (e)=>{ e.preventDefault(); });
  } else {
    giftBtn.classList.remove('disabled');
  }
})();

/* Reveal button: play audio (user gesture), show celebration, start effects */
let audioStarted = false;
revealBtn.addEventListener('click', async ()=>{
  try{ await audioEl.play(); audioStarted = true; } catch(e){ /* autoplay blocked if no gesture - click provides it */ }
  landing.style.transition = 'opacity .6s ease, transform .6s ease';
  landing.style.opacity = '0';
  landing.style.transform = 'scale(1.02)';
  setTimeout(()=>{ landing.style.display='none'; landing.setAttribute('aria-hidden','true'); }, 650);

  celebration.style.pointerEvents = 'auto';
  celebration.style.opacity = '1';
  celebration.setAttribute('aria-hidden','false');

  // start visuals
  startFallingFlowers();
  startBalloons();
  startConfettiLoop();
});

/* Mute / Unmute button */
function setMuteUI(isMuted){
  if(isMuted){
    // show muted icon
    muteIcon.innerHTML = '<path d="M11 5v14l-6-6H2V13h3l6-6z" fill="#7a1226"></path><path d="M19 8l-1.4 1.4L19 10.8 21.2 8.6 19 6.4 17.6 7.8 19 9.2z" fill="#7a1226"></path>';
  }else{
    // show speaker icon
    muteIcon.innerHTML = '<path d="M5 9v6h4l5 4V5L9 9H5z" fill="#7a1226"></path>';
  }
}
muteBtn.addEventListener('click', ()=>{
  audioEl.muted = !audioEl.muted;
  setMuteUI(audioEl.muted);
});

/* Pause audio when tab is hidden (minimized) and resume when visible (if it was playing and not muted) */
let wasPlayingBeforeHidden = false;
document.addEventListener('visibilitychange', ()=>{
  if(document.hidden){
    if(!audioEl.paused){
      audioEl.pause();
      wasPlayingBeforeHidden = true;
    } else {
      wasPlayingBeforeHidden = false;
    }
  } else {
    if(wasPlayingBeforeHidden && audioStarted && !audioEl.muted){
      audioEl.play().catch(()=>{});
    }
    wasPlayingBeforeHidden = false;
  }
});

/* Share button click behavior:
   Prefer navigator.share on supported devices; otherwise open waShare.href
   After sharing, clear input fields but keep greeting displayed (preview remains)
*/
waShare.addEventListener('click', async (e)=>{
  e.preventDefault();
  const nameTyped = (nameInput.value||'').trim();
  const msgTyped = (msgInput.value||'').trim();
  const nameToShare = nameTyped || current.name || DEFAULT_NAME;
  const msgToShare = msgTyped || current.msg || DEFAULT_MSG;
  const shareText = `${nameToShare} ki taraf se: ${msgToShare}\n${location.origin}${location.pathname}?name=${encodeURIComponent(nameToShare)}&msg=${encodeURIComponent(msgToShare)}`;

  if(navigator.share){
    try{
      await navigator.share({ title: 'Happy Navratri', text: shareText, url: '' });
    }catch(err){}
  } else {
    // open WhatsApp link in new tab
    const wa = `https://wa.me/?text=${encodeURIComponent(shareText)}`;
    window.open(wa, '_blank');
  }

  // After sharing: clear input fields but keep greeting preview as the shared text
  nameInput.value = '';
  msgInput.value = '';
  // Keep greeting showing the shared values:
  nameEl.textContent = nameToShare;
  msgEl.textContent = msgToShare;
  // rebuild waShare href for the new values
  updateWaLinkWith(nameToShare, msgToShare);
});

/* ----------------- Simple visual effects (flowers/balloons/confetti) ----------------- */
/* Flowers (emoji-like) - lower density */
const FLOWERS = ["üå∫","üå∏","üåº","üåπ","üåª"];
function startFallingFlowers(){
  const base = Math.max(6, Math.floor(innerWidth/140));
  for(let i=0;i<Math.floor(base*0.25);i++) createFlower();
  setInterval(()=>{ if(Math.random()>0.6) createFlower(); }, 1000);
}
function createFlower(){
  const el = document.createElement('div');
  el.style.position = 'absolute';
  el.style.zIndex = 12;
  const startX = Math.floor(Math.random()*(innerWidth*0.75))+innerWidth*0.125;
  el.style.left = startX + 'px';
  el.style.top = (-30 + Math.random()*-60) + 'px';
  el.style.fontSize = (Math.random()*14 + 16) + 'px';
  el.style.willChange = 'transform,opacity';
  el.textContent = FLOWERS[Math.floor(Math.random()*FLOWERS.length)];
  flowersLayer.appendChild(el);

  const duration = Math.random()*5000 + 4200;
  const endY = innerHeight*0.62 + Math.random()*(innerHeight*0.22);
  const start = performance.now();
  const rot = Math.random()*720 - 360;
  function frame(t){
    const p = Math.min(1,(t-start)/duration);
    const sway = Math.sin(p*Math.PI*2*(Math.random()*1.2+0.6))*40;
    const x = startX + sway;
    const y = -40 + p*(endY + Math.random()*60);
    el.style.transform = `translate(${x-startX}px, ${y}px) rotate(${rot*p}deg)`;
    el.style.opacity = 1 - p*0.95;
    if(p < 1) requestAnimationFrame(frame);
    else el.remove();
  }
  requestAnimationFrame(frame);
}

/* Balloons - small and slow */
function startBalloons(){
  const bCount = Math.max(5, Math.floor(innerWidth/220));
  for(let i=0;i<bCount;i++) createBalloon();
  setInterval(()=>{ if(Math.random()>0.5) createBalloon(); }, 2600);
}
function createBalloon(){
  const size = Math.floor(Math.random()*40 + 20);
  const el = document.createElement('div');
  el.style.position='absolute'; el.style.zIndex='11';
  const startX = Math.floor(Math.random()* (innerWidth - 40));
  el.style.left = startX + 'px';
  el.style.top = (-size - 10) + 'px';
  el.style.width = size + 'px';
  el.style.height = Math.round(size*1.18) + 'px';
  el.style.borderRadius='50%';
  el.style.pointerEvents='none';
  el.style.background = `radial-gradient(circle, ${getRandomNeon()}, ${getRandomNeon(0.45)})`;
  el.style.boxShadow = `0 8px 18px rgba(0,0,0,0.12)`;
  balloonsLayer.appendChild(el);

  const stick = document.createElement('div');
  stick.style.position='absolute';
  stick.style.left=(size/2-1)+'px'; stick.style.top=(Math.round(size*1.18))+'px';
  stick.style.width='2px'; stick.style.height=Math.max(18,size*0.6)+'px'; stick.style.background='rgba(0,0,0,0.06)';
  el.appendChild(stick);

  const duration = Math.random()*8000 + 7000;
  const driftX = Math.random()*240 - 120;
  const start = performance.now();
  function frame(t){
    const p = Math.min(1,(t-start)/duration);
    const x = startX + driftX*p + Math.sin(p*Math.PI*3)*10;
    const y = -size - 10 + p*(innerHeight + size + 80);
    el.style.transform = `translate(${x-startX}px, ${y}px) rotate(${Math.sin(p*6)*10}deg)`;
    if(p < 1) requestAnimationFrame(frame);
    else el.remove();
  }
  requestAnimationFrame(frame);
}
function getRandomNeon(opacity){
  const pool = ['#ff4da6','#ff2d68','#ffd166','#ff9aa2','#b3003b','#ffc857'];
  const c = pool[Math.floor(Math.random()*pool.length)];
  if(opacity){
    const r = parseInt(c.substr(1,2),16), g = parseInt(c.substr(3,2),16), b = parseInt(c.substr(5,2),16);
    return `rgba(${r},${g},${b},${opacity})`;
  }
  return c;
}

/* Simple confetti particles for bursts */
let particles = [];
class Particle {
  constructor(x,y,vx,vy,size,color,life,rect=false){ Object.assign(this,{x,y,vx,vy,size,color,life,age:0,rect}); }
  update(){ this.vy += 0.06; this.x += this.vx; this.y += this.vy; this.age += 1; }
  draw(ctx){
    ctx.save();
    ctx.globalAlpha = Math.max(0,1 - this.age/this.life);
    ctx.fillStyle = this.color;
    if(this.rect) ctx.fillRect(this.x - this.size/2, this.y - this.size/2, this.size, this.size);
    else { ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2); ctx.fill(); }
    ctx.restore();
  }
}
function spawnBurst(x,y,intensity){
  const colors = [getCSS('--accent-maroon','#7a1226'), getCSS('--accent-gold','#d4a017'), '#ffd6e1', '#fff6d0'];
  const sparks = Math.floor(10*intensity);
  for(let i=0;i<sparks;i++){
    const angle = Math.random()*Math.PI*2;
    const speed = (Math.random()*4+1)*(0.7+intensity);
    particles.push(new Particle(x,y,Math.cos(angle)*speed,Math.sin(angle)*speed,Math.random()*2+1,colors[Math.floor(Math.random()*colors.length)],Math.random()*60+40, Math.random()>0.5));
  }
}
function getCSS(varName, fallback){ try{ const v = getComputedStyle(document.documentElement).getPropertyValue(varName).trim(); return v||fallback; }catch(e){return fallback;} }

(function confettiLoop(){
  ctx.clearRect(0,0,cw,ch);
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.update();
    p.draw(ctx);
    if(p.age > p.life || p.y>ch+60) particles.splice(i,1);
  }
  requestAnimationFrame(confettiLoop);
})();

/* Optional: small timed bursts (also audio-reactive handled earlier in heavier code) */
function startConfettiLoop(){ setInterval(()=>{
  const x = Math.random()*innerWidth, y = innerHeight*0.3 + Math.random()*80;
  spawnBurst(x,y, 0.9 + Math.random()*1.6);
}, 2000); }

/* helper: audio-reactive bursts (light) using Analyser */
let audioCtx, analyser, srcNode, dataArray;
function startAudioEffects(audioEl){
  if(window._navAudioStarted) return; window._navAudioStarted = true;
  try{
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 2048;
    const bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);
    srcNode = audioCtx.createMediaElementSource(audioEl);
    srcNode.connect(analyser);
    analyser.connect(audioCtx.destination);

    let last = performance.now(), acc = 0;
    (function loop(t){
      const dt = Math.min(60,t-last)/16; last = t;
      analyser.getByteFrequencyData(dataArray);
      let low=0; const cutoff = Math.floor(dataArray.length*0.12);
      for(let i=0;i<cutoff;i++) low += dataArray[i];
      const avg = low/ (cutoff||1) / 255;
      acc += avg;
      if(acc > 1.6){
        const rect = qs('#navGif')?.getBoundingClientRect();
        const x = rect ? rect.left + rect.width*0.5 + (Math.random()-0.5)*rect.width*0.4 : Math.random()*cw;
        const y = rect ? rect.top + Math.random()*rect.height*0.2 : Math.random()*ch*0.4;
        spawnBurst(x,y, Math.min(3,1+avg*6));
        acc = 0;
      } else if(avg > 0.08 && Math.random() < 0.03 + avg*0.6){
        const rect = qs('#navGif')?.getBoundingClientRect();
        const x = rect ? rect.left + rect.width*0.5 + (Math.random()-0.5)*rect.width*0.4 : Math.random()*cw;
        const y = rect ? rect.top + Math.random()*rect.height*0.2 : Math.random()*ch*0.4;
        spawnBurst(x,y, Math.max(0.8, avg*2.4));
      }
      requestAnimationFrame(loop);
    })(performance.now());
  }catch(e){}
}

/* Accessibility: Enter reveals */
document.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && landing && landing.style.display!=='none') revealBtn.click(); });

/* Ensure mute UI initial */
setMuteUI(false);

/* Prevent scroll on touch */
window.addEventListener('touchmove', e=>{ if(document.body) e.preventDefault(); }, {passive:false});

/* --- Helper to play audio on user gesture from reveal: startAudioEffects called after audio play --- */
revealBtn.addEventListener('click', ()=>{ startAudioEffects(audioEl); });

</script>
</body>
</html>